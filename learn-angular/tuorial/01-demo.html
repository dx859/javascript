<!DOCTYPE html>
<html ng-app="my.new.module">

<head>
  <meta charset="UTF-8">
  <title>DEMO</title>
  <script src="../angular/angular.js"></script>
</head>

<body>
  <div ng-controller="books.list">
    <button add-book-button>Add book</button>
    <ul>
      <li ng-repeat="book in books">
        name: {{book.title}} | author: {{book.author}}
      </li>
    </ul>
  </div>





  <script type="text/javascript">
  // 1. setup a module
  var module = angular.module('my.new.module', []);

  // 2. create a new service. This moudle will be used for managing books.
  module.service('Book', ['$rootScope', function($rootScope) {

    var service = {
      books: [{
        title: "Magician",
        author: "Raymond E. Feist"
      }, {
        title: "The Hobbit",
        author: "J.R.R Tolkien"
      }],

      addBook: function(book) {
        service.books.push(book);
        $rootScope.$broadcast('books.update');
      }
    }

    return service;
  }]);

  // 3. Now, what we can do is pass this service around to the various controllers, directives, filters or whatever else may need it
  var ctrl = ['$scope', 'Book', function($scope, Book) {

    $scope.$on('books.update', function(event) {
     
      // $scope.books = Book.books;
      // $scope.$apply();
      $scope.$apply(function () {
        $scope.books = Book.books;
      });

    })

    $scope.books = Book.books;

    // $scope.addBook = function() {
    //   Book.addBook( { title: "Star Wars", author: "George Lucas" } );
    // };
  }];

  module.controller("books.list", ctrl);

  // 4. Directive
  module.directive("addBookButton", ['Book', function(Book) {
    return {
      restrict: "A",
      link: function(scope, element, attrs) {
        element.bind("click", function () {
          Book.addBook( { title: "Star Wars", author: "George Lucas" });
        });
      }
    }
  }]);
  </script>
</body>

</html>
